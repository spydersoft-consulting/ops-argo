argo-cd:
  global:
    storageClass: nfs-client
    # Apply sync-wave 10 to all resources (ConfigMaps, Services, Secrets, etc.)
    # Deployments/StatefulSets will override this with their specific waves (20+)
    additionalAnnotations:
      argocd.argoproj.io/sync-wave: "10"
    podAnnotations:
      linkerd.io/inject: enabled
  
  # Redis - sync first as it's required by other components
  redis:
    statefulsetAnnotations:
      argocd.argoproj.io/sync-wave: "20"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
  
  # Application Controller - sync second, depends on Redis
  controller:
    statefulsetAnnotations:
      argocd.argoproj.io/sync-wave: "30"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
  
  # Repo Server - sync third
  repoServer:
    deploymentAnnotations:
      argocd.argoproj.io/sync-wave: "40"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
  
  # ApplicationSet Controller - sync fourth
  applicationSet:
    deploymentAnnotations:
      argocd.argoproj.io/sync-wave: "50"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
  # Notifications Controller - sync fifth
  notifications:
    deploymentAnnotations:
      argocd.argoproj.io/sync-wave: "60"
    secret:
      create: false
      name: argocd-notifications-secret

    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  # Server - sync sixth (UI and API)
  server:
    deploymentAnnotations:
      argocd.argoproj.io/sync-wave: "70"
    ingress:
      enabled: false
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  configs:
    rbac:
      policy.default: role:readonly
      policy.csv: |
        p, role:org-admin, applications, *, */*, allow
        p, role:org-admin, applicationsets, *, */*, allow
        p, role:org-admin, clusters, get, *, allow
        p, role:org-admin, repositories, get, *, allow
        p, role:org-admin, repositories, create, *, allow
        p, role:org-admin, repositories, update, *, allow
        p, role:org-admin, repositories, delete, *, allow
        p, role:org-admin, projects, *, */*, allow
        p, role:org-admin, logs, *, */*, allow
        g, "bad2673a-2a0e-46f0-ab2f-bfe0c9b67274", role:org-admin
    cm:
      controller.diff.server.side: "true"
      url: https://argo.mattgerega.net
      help.chatUrl: https://spydersoft.slack.com/archives/C04S4AJV6E6
      resource.customizations.ignoreDifferences.all: |
        managedFieldsManagers:
        - external-secrets
      "dex.config": |
        logger:
          format: json
        connectors:
        - type: saml
          id: saml
          name: Azure AD
          config:
            entityIssuer: https://argo.mattgerega.net/api/dex/callback
            ssoURL: https://login.microsoftonline.com/70965cdd-c60c-4109-9fcf-709b2f23bd0c/saml2
            caData: $argo-azuread-secret:cert
            redirectURI: https://argo.mattgerega.net/api/dex/callback
            usernameAttr: email
            emailAttr: email
            groupsAttr: group
    params:
      server.insecure: true
      server.repo.server.strict.tls: false
      server.rootpath: ""
    repositories:
      argo-helm:
        url: https://argoproj.github.io/argo-helm
        name: argo-helm
        type: helm
      git-ops-nonprod-cluster:
        name: git-ops-nonprod-cluster
        url: https://github.com/spydersoft-consulting/ops-nonprod-cluster
        type: git
      git-ops-prod-cluster:
        name: git-ops-nonprod-cluster
        url: https://github.com/spydersoft-consulting/ops-nonprod-cluster
        type: git
